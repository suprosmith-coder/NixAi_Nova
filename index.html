<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyanix AI | Nix-Powered Assistant</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --cyan-primary: #00f3ff;
            --cyan-secondary: #00a8b5;
            --cyan-light: #6bffff;
            --cyan-glow: 0 0 15px rgba(0, 243, 255, 0.7);
            --purple-dark: #0a0118;
            --purple-deep: #120229;
            --purple-neon: #7d00ff;
            --green-neon: #00ff88;
            --red-neon: #ff4757;
            --yellow-neon: #FFD700;
            --gray-dark: #151520;
            --gray-medium: #252535;
            --gray-light: #f5f5f7;
            --white: #ffffff;
            --black: #000000;
            --neon-glow: 0 0 10px var(--cyan-primary), 0 0 20px var(--cyan-primary), 0 0 30px rgba(0, 243, 255, 0.5);
            --neon-glow-purple: 0 0 10px var(--purple-neon), 0 0 20px rgba(125, 0, 255, 0.5);
            --scanline-color: rgba(0, 243, 255, 0.1);
            --grid-color: rgba(0, 243, 255, 0.05);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--purple-dark);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Futuristic background effects */
        .cyber-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -1;
            opacity: 0.3;
            animation: gridMove 20s linear infinite;
        }

        .cyber-scanline {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to bottom, transparent, var(--scanline-color), transparent);
            z-index: 999;
            animation: scanline 8s linear infinite;
            pointer-events: none;
        }

        .floating-orbs {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            overflow: hidden;
            pointer-events: none;
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(40px);
            opacity: 0.1;
        }

        .orb-1 {
            width: 300px;
            height: 300px;
            background: var(--cyan-primary);
            top: 10%;
            left: 5%;
            animation: float 25s ease-in-out infinite;
        }

        .orb-2 {
            width: 200px;
            height: 200px;
            background: var(--purple-neon);
            top: 60%;
            right: 10%;
            animation: float 20s ease-in-out infinite reverse;
        }

        .orb-3 {
            width: 150px;
            height: 150px;
            background: var(--yellow-neon);
            bottom: 20%;
            left: 20%;
            animation: float 30s ease-in-out infinite;
        }

        /* Splash Screen */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--purple-dark);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            overflow: hidden;
        }

        .splash-screen::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, transparent 0%, var(--purple-dark) 70%);
            z-index: -1;
        }

        .splash-logo {
            width: 140px;
            height: 140px;
            background: linear-gradient(135deg, var(--cyan-secondary), var(--cyan-primary));
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            box-shadow: var(--neon-glow);
            margin-bottom: 30px;
            animation: pulse 2s infinite alternate, rotate 10s linear infinite;
            position: relative;
        }

        .splash-logo::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 24px;
            background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shine 3s infinite linear;
        }

        .splash-title {
            font-size: 48px;
            font-weight: 900;
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, var(--cyan-primary), var(--cyan-light), var(--purple-neon));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            animation: textGlow 2s infinite alternate;
        }

        .splash-subtitle {
            font-size: 18px;
            color: var(--cyan-light);
            opacity: 0.8;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        .loading-bar {
            width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-top: 40px;
            overflow: hidden;
            position: relative;
        }

        .loading-progress {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, var(--cyan-primary), var(--purple-neon));
            border-radius: 2px;
            transition: width 3s ease-in-out;
            position: relative;
            overflow: hidden;
        }

        .loading-progress::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            animation: loadingShine 2s infinite;
        }

        /* Auth Container */
        .auth-container {
            display: flex;
            min-height: 100vh;
            opacity: 0;
            animation: fadeIn 0.8s forwards 0.5s;
        }

        .auth-left {
            flex: 1;
            background: linear-gradient(135deg, var(--purple-dark), var(--purple-deep));
            padding: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .auth-left::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 60%, rgba(0, 243, 255, 0.05) 100%);
        }

        .auth-right {
            flex: 1;
            background: rgba(21, 21, 32, 0.8);
            padding: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            backdrop-filter: blur(10px);
            border-left: 1px solid rgba(0, 243, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .auth-right::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(125, 0, 255, 0.05) 0%, transparent 40%);
        }

        .auth-logo {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 40px;
            animation: slideInLeft 0.8s ease-out;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--cyan-secondary), var(--cyan-primary));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: var(--neon-glow);
            position: relative;
            animation: pulse 2s infinite alternate;
        }

        .logo-icon::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 15px;
            border: 2px solid transparent;
            background: linear-gradient(135deg, var(--cyan-primary), transparent) border-box;
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            animation: rotate 5s linear infinite;
        }

        .logo-text {
            font-size: 32px;
            font-weight: 900;
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, var(--cyan-primary), var(--cyan-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1px;
        }

        .auth-title {
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 15px;
            line-height: 1.2;
            font-family: 'Orbitron', sans-serif;
            animation: slideInLeft 0.8s ease-out 0.2s both;
        }

        .auth-subtitle {
            font-size: 18px;
            color: var(--cyan-light);
            opacity: 0.9;
            margin-bottom: 40px;
            animation: slideInLeft 0.8s ease-out 0.3s both;
        }

        .features-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 40px;
            animation: slideInLeft 0.8s ease-out 0.4s both;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--cyan-light);
            font-size: 14px;
            padding: 15px;
            background: rgba(0, 243, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(0, 243, 255, 0.1);
            transition: all 0.3s;
        }

        .feature-item:hover {
            transform: translateY(-5px);
            background: rgba(0, 243, 255, 0.1);
            box-shadow: var(--neon-glow);
        }

        .feature-icon {
            color: var(--cyan-primary);
            font-size: 20px;
            min-width: 24px;
        }

        /* Auth Forms */
        .auth-form {
            max-width: 400px;
            margin: 0 auto;
            width: 100%;
            animation: slideInRight 0.8s ease-out;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 40px;
            background: var(--gray-medium);
            padding: 6px;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .auth-tabs::before {
            content: '';
            position: absolute;
            width: 50%;
            height: calc(100% - 12px);
            background: var(--cyan-primary);
            top: 6px;
            left: 6px;
            border-radius: 8px;
            box-shadow: var(--neon-glow);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            z-index: 1;
        }

        .auth-tabs.signup-active::before {
            transform: translateX(100%);
        }

        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: transparent;
            border: none;
            color: var(--white);
            font-size: 16px;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            z-index: 2;
        }

        .auth-tab.active {
            color: var(--purple-dark);
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 24px;
            animation: fadeInUp 0.5s ease-out;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--cyan-light);
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 0.5px;
        }

        .form-input {
            width: 100%;
            padding: 16px;
            background: rgba(37, 37, 53, 0.8);
            border: 2px solid transparent;
            border-radius: 12px;
            font-size: 16px;
            color: var(--white);
            transition: all 0.3s;
            font-family: 'Inter', sans-serif;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--cyan-primary);
            box-shadow: var(--neon-glow);
            background: rgba(37, 37, 53, 0.9);
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .password-wrapper {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--cyan-light);
            cursor: pointer;
            transition: all 0.3s;
        }

        .password-toggle:hover {
            color: var(--cyan-primary);
            transform: translateY(-50%) scale(1.1);
        }

        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .remember-me {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--cyan-light);
            cursor: pointer;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--cyan-primary);
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            background: transparent;
            transition: all 0.3s;
        }

        .checkbox:checked {
            background: var(--cyan-primary);
            box-shadow: 0 0 10px var(--cyan-primary);
        }

        .checkbox:checked::after {
            content: 'âœ“';
            position: absolute;
            color: var(--purple-dark);
            font-weight: bold;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .forgot-password {
            color: var(--cyan-primary);
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s;
            position: relative;
        }

        .forgot-password:hover {
            text-shadow: 0 0 10px var(--cyan-primary);
        }

        .forgot-password::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 1px;
            background: var(--cyan-primary);
            transition: width 0.3s;
        }

        .forgot-password:hover::after {
            width: 100%;
        }

        .auth-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--cyan-secondary), var(--cyan-primary));
            color: var(--purple-dark);
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 30px;
            box-shadow: var(--neon-glow);
            position: relative;
            overflow: hidden;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        .auth-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 20px var(--cyan-primary), 0 0 40px rgba(0, 243, 255, 0.5);
        }

        .auth-btn:active {
            transform: translateY(-1px);
        }

        .auth-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .auth-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.7s;
        }

        .auth-btn:hover::after {
            left: 100%;
        }

        .auth-divider {
            display: flex;
            align-items: center;
            margin: 30px 0;
            color: var(--cyan-light);
            font-size: 14px;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--cyan-primary), transparent);
        }

        .auth-divider span {
            padding: 0 20px;
        }

        .social-auth {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 30px;
        }

        .social-btn {
            padding: 16px;
            background: rgba(37, 37, 53, 0.8);
            border: 2px solid transparent;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 20px;
            color: var(--white);
            position: relative;
            overflow: hidden;
        }

        .social-btn:hover {
            transform: translateY(-5px);
            border-color: var(--cyan-primary);
            box-shadow: var(--neon-glow);
        }

        .social-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 243, 255, 0.2), transparent);
            transition: left 0.7s;
        }

        .social-btn:hover::before {
            left: 100%;
        }

        .google-btn { color: #4285F4; }
        .microsoft-btn { color: #00A4EF; }
        .email-btn { color: var(--cyan-primary); }

        .auth-footer {
            text-align: center;
            color: var(--cyan-light);
            font-size: 14px;
        }

        .auth-footer a {
            color: var(--cyan-primary);
            text-decoration: none;
            transition: all 0.3s;
            position: relative;
        }

        .auth-footer a:hover {
            text-shadow: 0 0 10px var(--cyan-primary);
        }

        .auth-footer a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 1px;
            background: var(--cyan-primary);
            transition: width 0.3s;
        }

        .auth-footer a:hover::after {
            width: 100%;
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(21, 21, 32, 0.95);
            border: 2px solid var(--cyan-primary);
            border-radius: 12px;
            padding: 15px 20px;
            color: var(--white);
            box-shadow: var(--neon-glow);
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            transform: translateX(150%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            backdrop-filter: blur(10px);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success { border-color: var(--green-neon); box-shadow: 0 0 15px rgba(0, 255, 136, 0.7); }
        .toast.error { border-color: var(--red-neon); box-shadow: 0 0 15px rgba(255, 71, 87, 0.7); }
        .toast.info { border-color: var(--cyan-primary); box-shadow: 0 0 15px rgba(0, 243, 255, 0.7); }
        .toast.warning { border-color: var(--yellow-neon); box-shadow: 0 0 15px rgba(255, 215, 0, 0.7); }

        .toast-icon {
            font-size: 20px;
        }

        .toast-message {
            flex: 1;
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--cyan-light);
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .toast-close:hover {
            color: var(--cyan-primary);
            transform: scale(1.2);
        }

        /* Chat Interface */
        .chat-container {
            display: none;
            height: 100vh;
            opacity: 0;
            transition: opacity 0.8s;
        }

        .chat-container.active {
            display: block;
            opacity: 1;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100%;
            background: rgba(10, 1, 24, 0.9);
            border-right: 1px solid rgba(0, 243, 255, 0.1);
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(10px);
            z-index: 100;
            transform: translateX(-100%);
            animation: slideInLeft 0.5s forwards 0.3s;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 70%, rgba(0, 243, 255, 0.05) 100%);
            pointer-events: none;
        }

        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid rgba(0, 243, 255, 0.1);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sidebar-logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--cyan-secondary), var(--cyan-primary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: var(--neon-glow);
            animation: pulse 3s infinite alternate;
        }

        .sidebar-logo-text {
            font-size: 22px;
            font-weight: 900;
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, var(--cyan-primary), var(--cyan-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1px;
        }

        .sidebar-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .sidebar-section {
            margin-bottom: 25px;
        }

        .sidebar-title {
            font-size: 12px;
            color: var(--cyan-light);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            opacity: 0.7;
            font-family: 'Orbitron', sans-serif;
        }

        .sidebar-btn {
            width: 100%;
            padding: 14px;
            background: rgba(0, 243, 255, 0.05);
            color: var(--white);
            border: 1px solid rgba(0, 243, 255, 0.1);
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s;
            text-align: left;
        }

        .sidebar-btn:hover {
            background: rgba(0, 243, 255, 0.1);
            border-color: var(--cyan-primary);
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 243, 255, 0.2);
        }

        .sidebar-btn.active {
            background: linear-gradient(135deg, rgba(0, 243, 255, 0.2), rgba(0, 168, 181, 0.1));
            border-color: var(--cyan-primary);
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.3);
        }

        .sidebar-btn-icon {
            font-size: 16px;
            color: var(--cyan-primary);
            min-width: 20px;
        }

        .ai-model-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            background: rgba(0, 255, 136, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 10px;
            margin-top: 10px;
        }

        .ai-model-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--green-neon);
            box-shadow: 0 0 10px var(--green-neon);
            animation: pulse 2s infinite;
        }

        .ai-model-text {
            font-size: 12px;
            color: var(--cyan-light);
        }

        .new-chat-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--cyan-secondary), var(--cyan-primary));
            color: var(--purple-dark);
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: var(--neon-glow);
            transition: all 0.3s;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .new-chat-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 20px var(--cyan-primary), 0 0 40px rgba(0, 243, 255, 0.5);
        }

        .new-chat-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.7s;
        }

        .new-chat-btn:hover::after {
            left: 100%;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(0, 243, 255, 0.1);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(0, 243, 255, 0.05);
        }

        .user-profile:hover {
            background: rgba(0, 243, 255, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 243, 255, 0.2);
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--cyan-secondary), var(--cyan-primary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--purple-dark);
            font-size: 18px;
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--white);
            margin-bottom: 2px;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 0.5px;
        }

        .user-email {
            font-size: 12px;
            color: var(--cyan-light);
            opacity: 0.8;
        }

        .main-chat {
            margin-left: 280px;
            height: 100%;
            display: flex;
            flex-direction: column;
            opacity: 0;
            animation: fadeIn 0.8s forwards 0.5s;
        }

        .chat-header {
            padding: 20px;
            background: rgba(10, 1, 24, 0.9);
            border-bottom: 1px solid rgba(0, 243, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 20px;
            backdrop-filter: blur(10px);
        }

        .chat-title {
            flex: 1;
            font-size: 20px;
            font-weight: 700;
            color: var(--white);
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        .chat-header-actions {
            display: flex;
            gap: 10px;
        }

        .header-btn {
            padding: 10px 16px;
            background: rgba(0, 243, 255, 0.1);
            border: 1px solid rgba(0, 243, 255, 0.2);
            border-radius: 10px;
            color: var(--cyan-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .header-btn:hover {
            background: rgba(0, 243, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 243, 255, 0.2);
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 40px 20px;
            background: var(--purple-dark);
        }

        .welcome-screen {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            padding-top: 60px;
            animation: fadeInUp 1s ease-out;
        }

        .welcome-icon {
            font-size: 80px;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--cyan-secondary), var(--cyan-primary), var(--purple-neon));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: pulse 3s infinite alternate;
        }

        .welcome-title {
            font-size: 56px;
            font-weight: 900;
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, var(--cyan-primary), var(--cyan-light), var(--purple-neon));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            letter-spacing: 2px;
            text-transform: uppercase;
            animation: textGlow 2s infinite alternate;
        }

        .welcome-subtitle {
            font-size: 20px;
            color: var(--cyan-light);
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto 40px;
            line-height: 1.6;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        .example-prompts {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            max-width: 600px;
            margin: 40px auto;
        }

        .example-prompt {
            padding: 25px;
            background: rgba(0, 243, 255, 0.05);
            border: 1px solid rgba(0, 243, 255, 0.1);
            border-radius: 15px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .example-prompt:hover {
            transform: translateY(-10px);
            background: rgba(0, 243, 255, 0.1);
            border-color: var(--cyan-primary);
            box-shadow: var(--neon-glow);
        }

        .example-prompt::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 243, 255, 0.1), transparent);
            transition: left 0.7s;
        }

        .example-prompt:hover::before {
            left: 100%;
        }

        .example-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 600;
            color: var(--cyan-primary);
            margin-bottom: 10px;
            font-family: 'Orbitron', sans-serif;
        }

        .example-text {
            font-size: 14px;
            color: var(--cyan-light);
            line-height: 1.5;
        }

        .input-container {
            padding: 20px;
            background: rgba(10, 1, 24, 0.9);
            border-top: 1px solid rgba(0, 243, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .input-wrapper {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .attached-files-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(0, 243, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(0, 243, 255, 0.1);
        }

        .attached-file-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(0, 243, 255, 0.1);
            border-radius: 8px;
            font-size: 12px;
            color: var(--cyan-light);
        }

        .attached-file-item .remove-file {
            background: none;
            border: none;
            color: var(--red-neon);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .attached-file-item .remove-file:hover {
            transform: scale(1.2);
        }

        .chat-input {
            width: 100%;
            min-height: 56px;
            padding: 16px 120px 16px 20px;
            background: rgba(0, 243, 255, 0.05);
            border: 2px solid rgba(0, 243, 255, 0.2);
            border-radius: 16px;
            font-size: 16px;
            color: var(--white);
            resize: none;
            transition: all 0.3s;
            font-family: 'Inter', sans-serif;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--cyan-primary);
            box-shadow: var(--neon-glow);
            background: rgba(0, 243, 255, 0.08);
        }

        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .input-buttons {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 10px;
        }

        .input-btn {
            width: 45px;
            height: 45px;
            background: rgba(0, 243, 255, 0.1);
            border: none;
            border-radius: 50%;
            color: var(--cyan-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s;
        }

        .input-btn:hover {
            background: rgba(0, 243, 255, 0.2);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.5);
        }

        .input-btn.send {
            background: linear-gradient(135deg, var(--cyan-secondary), var(--cyan-primary));
            color: var(--purple-dark);
            box-shadow: var(--neon-glow);
        }

        .input-btn.send:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 0 20px var(--cyan-primary), 0 0 40px rgba(0, 243, 255, 0.5);
        }

        /* Message Styles */
        .message {
            max-width: 800px;
            margin: 0 auto 30px;
            padding: 25px;
            background: rgba(0, 243, 255, 0.03);
            border-radius: 20px;
            border: 1px solid rgba(0, 243, 255, 0.1);
            animation: fadeInUp 0.5s ease-out;
            position: relative;
            overflow: hidden;
        }

        .message.user {
            background: linear-gradient(135deg, rgba(0, 243, 255, 0.1), rgba(0, 168, 181, 0.05));
            border: 1px solid rgba(0, 243, 255, 0.2);
            animation: slideInRight 0.5s ease-out;
        }

        .message.assistant {
            animation: slideInLeft 0.5s ease-out;
        }

        .message::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 60%, rgba(0, 243, 255, 0.02) 100%);
            pointer-events: none;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
        }

        .message-avatar.user {
            background: linear-gradient(135deg, var(--cyan-secondary), var(--cyan-primary));
            color: var(--purple-dark);
        }

        .message-avatar.assistant {
            background: linear-gradient(135deg, #7d00ff, #9d4edd);
            color: var(--white);
            animation: pulse 3s infinite alternate;
        }

        .message-sender {
            font-size: 16px;
            font-weight: 700;
            color: var(--white);
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 0.5px;
        }

        .message-content {
            font-size: 16px;
            line-height: 1.6;
            color: var(--cyan-light);
        }

        .message-content pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 10px 0;
            border: 1px solid rgba(0, 243, 255, 0.1);
        }

        .message-content code {
            background: rgba(0, 243, 255, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: var(--cyan-light);
        }

        /* File attachments in messages */
        .message-files {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .message-file {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 243, 255, 0.05);
            border: 1px solid rgba(0, 243, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            max-width: 300px;
        }

        .message-file:hover {
            background: rgba(0, 243, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 243, 255, 0.2);
        }

        .message-file-icon {
            font-size: 24px;
            color: var(--cyan-primary);
        }

        .message-file-info {
            flex: 1;
            min-width: 0;
        }

        .message-file-name {
            font-size: 12px;
            font-weight: 600;
            color: var(--white);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .message-file-size {
            font-size: 11px;
            color: var(--cyan-light);
            opacity: 0.7;
        }

        /* Image preview in messages */
        .message-image {
            max-width: 300px;
            border-radius: 10px;
            margin-top: 15px;
            border: 2px solid rgba(0, 243, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s;
        }

        .message-image:hover {
            border-color: var(--cyan-primary);
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
            transform: scale(1.02);
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 15px 0;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--cyan-primary);
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        /* Model Selection Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }

        .modal {
            background: linear-gradient(135deg, var(--purple-dark), var(--purple-deep));
            border: 2px solid var(--cyan-primary);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--neon-glow);
            position: relative;
            animation: slideInDown 0.5s ease-out;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--cyan-primary);
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--cyan-light);
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-close:hover {
            color: var(--cyan-primary);
            transform: scale(1.2);
        }

        .modal-description {
            color: var(--cyan-light);
            margin-bottom: 25px;
            line-height: 1.6;
            font-size: 14px;
        }

        .model-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .model-btn {
            padding: 20px;
            background: rgba(0, 243, 255, 0.05);
            border: 2px solid transparent;
            border-radius: 15px;
            color: var(--white);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .model-btn:hover {
            background: rgba(0, 243, 255, 0.1);
            transform: translateY(-5px);
            border-color: rgba(0, 243, 255, 0.2);
        }

        .model-btn.active {
            background: linear-gradient(135deg, rgba(0, 243, 255, 0.2), rgba(0, 168, 181, 0.1));
            border-color: var(--cyan-primary);
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
        }

        .model-icon {
            font-size: 24px;
            color: var(--cyan-primary);
        }

        .model-name {
            font-weight: 600;
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
        }

        .model-desc {
            font-size: 12px;
            color: var(--cyan-light);
            opacity: 0.8;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }

        .modal-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 0.5px;
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, var(--cyan-secondary), var(--cyan-primary));
            color: var(--purple-dark);
            box-shadow: var(--neon-glow);
        }

        .modal-btn.secondary {
            background: rgba(0, 243, 255, 0.1);
            color: var(--cyan-primary);
            border: 1px solid rgba(0, 243, 255, 0.2);
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 243, 255, 0.3);
        }

        /* Model Info */
        .model-info {
            background: rgba(0, 243, 255, 0.1);
            border: 1px solid rgba(0, 243, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }

        .model-info h4 {
            color: var(--cyan-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .model-info ul {
            color: var(--cyan-light);
            font-size: 13px;
            line-height: 1.6;
            padding-left: 20px;
        }

        /* File Attachment Modal */
        .file-drop-zone {
            border: 2px dashed var(--cyan-primary);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(0, 243, 255, 0.05);
        }

        .file-drop-zone:hover {
            background: rgba(0, 243, 255, 0.1);
            border-color: var(--cyan-light);
        }

        .file-drop-zone.drag-over {
            background: rgba(0, 243, 255, 0.2);
            border-color: var(--cyan-light);
            box-shadow: var(--neon-glow);
        }

        .file-drop-content h4 {
            color: var(--cyan-primary);
            margin-bottom: 10px;
            font-family: 'Orbitron', sans-serif;
        }

        .file-drop-content p {
            color: var(--cyan-light);
            margin-bottom: 20px;
        }

        .file-types-info {
            font-size: 12px;
            color: var(--cyan-light);
            opacity: 0.7;
            margin-bottom: 20px;
        }

        .selected-files-container {
            margin-top: 20px;
        }

        .selected-files-container h4 {
            color: var(--cyan-primary);
            margin-bottom: 15px;
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
        }

        .selected-files-list {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 243, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(0, 243, 255, 0.1);
        }

        .selected-file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: rgba(0, 243, 255, 0.1);
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.3s;
        }

        .selected-file-item:hover {
            background: rgba(0, 243, 255, 0.15);
            transform: translateX(5px);
        }

        .selected-file-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            min-width: 0;
        }

        .selected-file-icon {
            font-size: 18px;
            color: var(--cyan-primary);
            min-width: 24px;
        }

        .selected-file-details {
            flex: 1;
            min-width: 0;
        }

        .selected-file-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--white);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .selected-file-size {
            font-size: 11px;
            color: var(--cyan-light);
            opacity: 0.7;
        }

        .selected-file-remove {
            background: none;
            border: none;
            color: var(--red-neon);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            padding: 5px;
        }

        .selected-file-remove:hover {
            transform: scale(1.2);
        }

        .file-upload-progress {
            height: 4px;
            background: rgba(0, 243, 255, 0.1);
            border-radius: 2px;
            margin-top: 5px;
            overflow: hidden;
        }

        .file-upload-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--cyan-secondary), var(--cyan-primary));
            border-radius: 2px;
            transition: width 0.3s;
        }

        /* File Preview Modal */
        .file-preview-content {
            max-height: 500px;
            overflow-y: auto;
            padding: 20px;
            background: rgba(0, 243, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(0, 243, 255, 0.1);
        }

        .file-preview-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 10px;
            border: 2px solid rgba(0, 243, 255, 0.2);
        }

        .file-preview-text {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: var(--cyan-light);
            white-space: pre-wrap;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
        }

        .file-preview-info {
            padding: 15px;
            background: rgba(0, 243, 255, 0.05);
            border-radius: 10px;
            margin-top: 20px;
        }

        .file-preview-info h4 {
            color: var(--cyan-primary);
            margin-bottom: 10px;
            font-family: 'Orbitron', sans-serif;
        }

        .file-preview-info p {
            color: var(--cyan-light);
            font-size: 13px;
            margin-bottom: 5px;
        }

        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 10px var(--cyan-primary); }
            100% { transform: scale(1.05); box-shadow: 0 0 20px var(--cyan-primary), 0 0 40px rgba(0, 243, 255, 0.5); }
        }

        @keyframes textGlow {
            0% { text-shadow: 0 0 10px rgba(0, 243, 255, 0.5); }
            100% { text-shadow: 0 0 20px rgba(0, 243, 255, 0.8), 0 0 30px rgba(125, 0, 255, 0.5); }
        }

        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        @keyframes fadeInUp {
            0% { opacity: 0; transform: translateY(30px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInLeft {
            0% { opacity: 0; transform: translateX(-30px); }
            100% { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideInRight {
            0% { opacity: 0; transform: translateX(30px); }
            100% { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideInDown {
            0% { opacity: 0; transform: translateY(-30px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        @keyframes loadingShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes gridMove {
            0% { background-position: 0 0; }
            100% { background-position: 50px 50px; }
        }

        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100vh); }
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.6; }
            30% { transform: translateY(-10px); opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .auth-container {
                flex-direction: column;
            }
            .auth-left, .auth-right {
                padding: 40px 20px;
            }
            .features-list {
                grid-template-columns: 1fr;
            }
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                transform: translateX(0);
                animation: none;
            }
            .main-chat {
                margin-left: 0;
                animation: none;
            }
            .example-prompts {
                grid-template-columns: 1fr;
            }
            .welcome-title {
                font-size: 32px;
            }
            .welcome-subtitle {
                font-size: 16px;
            }
            .auth-title {
                font-size: 32px;
            }
            .splash-title {
                font-size: 36px;
            }
            .chat-header-actions {
                display: none;
            }
            .model-selector {
                grid-template-columns: 1fr;
            }
            .message-files {
                flex-direction: column;
            }
            .message-file {
                max-width: 100%;
            }
            .message-image {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Cyberpunk Background Effects -->
    <div class="cyber-grid"></div>
    <div class="cyber-scanline"></div>
    <div class="floating-orbs">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <!-- Splash Screen -->
    <div id="splashScreen" class="splash-screen">
        <div class="splash-logo">
            <i class="fas fa-robot"></i>
        </div>
        <h1 class="splash-title">Cyanix AI</h1>
        <p class="splash-subtitle">Powered by Advanced AI Models</p>
        <div class="loading-bar">
            <div class="loading-progress" id="loadingProgress"></div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <!-- File Preview Modal -->
    <div id="filePreviewModal" class="modal-overlay">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">File Preview</h3>
                <button class="modal-close" onclick="closeFilePreviewModal()">&times;</button>
            </div>
            <div class="modal-content">
                <div id="filePreviewContent" class="file-preview-content">
                    <!-- File preview will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button class="modal-btn secondary" onclick="closeFilePreviewModal()">Close</button>
                    <button id="downloadPreviewBtn" class="modal-btn primary" onclick="downloadPreviewFile()">
                        <i class="fas fa-download"></i> Download
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- File Attachment Modal -->
    <div id="fileAttachmentModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Attach Files</h3>
                <button class="modal-close" onclick="closeFileAttachmentModal()">&times;</button>
            </div>
            <div class="modal-content">
                <div class="file-drop-zone" id="fileDropZone">
                    <div class="file-drop-content">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 60px; color: var(--cyan-primary); margin-bottom: 20px;"></i>
                        <h4>Drag & Drop Files Here</h4>
                        <p>or click to browse</p>
                        <p class="file-types-info">Supports: JPG, PNG, GIF, PDF, TXT, DOC, DOCX</p>
                        <input type="file" id="fileInput" multiple accept=".jpg,.jpeg,.png,.gif,.pdf,.txt,.doc,.docx" style="display: none;">
                        <button class="modal-btn primary" onclick="document.getElementById('fileInput').click()">
                            <i class="fas fa-folder-open"></i> Browse Files
                        </button>
                    </div>
                </div>
                
                <div class="selected-files-container" id="selectedFilesContainer">
                    <h4>Selected Files:</h4>
                    <div id="selectedFilesList" class="selected-files-list">
                        <!-- Selected files will appear here -->
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button class="modal-btn secondary" onclick="closeFileAttachmentModal()">Cancel</button>
                    <button class="modal-btn primary" onclick="uploadSelectedFiles()">
                        <i class="fas fa-upload"></i> Upload Files
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Model Selection Modal -->
    <div id="modelModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Select AI Model</h3>
                <button class="modal-close" onclick="closeModelModal()">&times;</button>
            </div>
            <div class="modal-content">
                <p class="modal-description">
                    Choose which AI model you'd like to use. All models are powered by Cyanix's advanced infrastructure.
                </p>
                
                <div class="model-selector" id="modelSelector">
                    <div class="model-btn active" data-model="cyanix-pro" onclick="selectModel('cyanix-pro')">
                        <i class="fas fa-brain model-icon"></i>
                        <div class="model-name">Cyanix Pro</div>
                        <div class="model-desc">Most capable model for complex tasks</div>
                    </div>
                    <div class="model-btn" data-model="cyanix-flash" onclick="selectModel('cyanix-flash')">
                        <i class="fas fa-bolt model-icon"></i>
                        <div class="model-name">Cyanix Flash</div>
                        <div class="model-desc">Fast & efficient for everyday tasks</div>
                    </div>
                    <div class="model-btn" data-model="cyanix-vision" onclick="selectModel('cyanix-vision')">
                        <i class="fas fa-eye model-icon"></i>
                        <div class="model-name">Cyanix Vision</div>
                        <div class="model-desc">Image analysis and description</div>
                    </div>
                    <div class="model-btn" data-model="cyanix-advanced" onclick="selectModel('cyanix-advanced')">
                        <i class="fas fa-robot model-icon"></i>
                        <div class="model-name">Cyanix Advanced</div>
                        <div class="model-desc">Expert model for specialized tasks</div>
                    </div>
                </div>
                
                <div class="model-info">
                    <h4><i class="fas fa-info-circle"></i> Model Information:</h4>
                    <ul>
                        <li><strong>Cyanix Pro:</strong> Best for complex reasoning, analysis, and creative tasks</li>
                        <li><strong>Cyanix Flash:</strong> Fastest response times for general queries</li>
                        <li><strong>Cyanix Vision:</strong> Specialized in image analysis and description</li>
                        <li><strong>Cyanix Advanced:</strong> Expert-level knowledge for specialized fields</li>
                    </ul>
                </div>
                
                <div class="modal-footer">
                    <button class="modal-btn secondary" onclick="closeModelModal()">Cancel</button>
                    <button class="modal-btn primary" onclick="saveModelSelection()">Select Model</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Container -->
    <div id="authContainer" class="auth-container">
        <div class="auth-left">
            <div class="auth-logo">
                <div class="logo-icon">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="logo-text">Cyanix AI</div>
            </div>
            
            <h1 class="auth-title">Welcome to the Future of AI Conversation</h1>
            <p class="auth-subtitle">No API keys required - powered by Cyanix infrastructure</p>
            
            <div class="features-list">
                <div class="feature-item">
                    <i class="fas fa-bolt feature-icon"></i>
                    <span>No API Keys Required</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-shield-alt feature-icon"></i>
                    <span>End-to-End Encryption</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-history feature-icon"></i>
                    <span>Unlimited Conversation History</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-code feature-icon"></i>
                    <span>Code Execution Support</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-file-export feature-icon"></i>
                    <span>Export Conversations</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-paperclip feature-icon"></i>
                    <span>File Attachments</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-image feature-icon"></i>
                    <span>Image Support</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-brain feature-icon"></i>
                    <span>Multiple AI Models</span>
                </div>
            </div>
        </div>
        
        <div class="auth-right">
            <div class="auth-form" id="authForm">
                <div class="auth-tabs" id="authTabs">
                    <button class="auth-tab active" onclick="switchAuthTab('signin')">Sign In</button>
                    <button class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</button>
                </div>
                
                <!-- Sign In Form -->
                <div id="signinForm" class="auth-form-content">
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" id="signinEmail" class="form-input" placeholder="Enter your email">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <div class="password-wrapper">
                            <input type="password" id="signinPassword" class="form-input" placeholder="Enter your password">
                            <button class="password-toggle" type="button" onclick="togglePassword('signinPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-options">
                        <label class="remember-me">
                            <input type="checkbox" id="rememberMe" class="checkbox">
                            <span>Remember me</span>
                        </label>
                        <a href="#" class="forgot-password" onclick="showForgotPassword()">Forgot Password?</a>
                    </div>
                    
                    <button class="auth-btn" onclick="signInWithEmail()">Sign In</button>
                    
                    <div class="auth-divider">
                        <span>Or continue with</span>
                    </div>
                    
                    <div class="social-auth">
                        <button class="social-btn google-btn" onclick="signInWithGoogle()">
                            <i class="fab fa-google"></i>
                        </button>
                        <button class="social-btn microsoft-btn" onclick="signInWithMicrosoft()">
                            <i class="fab fa-microsoft"></i>
                        </button>
                    </div>
                    
                    <p class="auth-footer">
                        Don't have an account? <a href="#" onclick="switchAuthTab('signup')">Sign Up</a>
                    </p>
                </div>
                
                <!-- Sign Up Form -->
                <div id="signupForm" class="auth-form-content" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" id="signupName" class="form-input" placeholder="Enter your full name">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" id="signupEmail" class="form-input" placeholder="Enter your email">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <div class="password-wrapper">
                            <input type="password" id="signupPassword" class="form-input" placeholder="Create a password (min. 8 chars)">
                            <button class="password-toggle" type="button" onclick="togglePassword('signupPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Confirm Password</label>
                        <div class="password-wrapper">
                            <input type="password" id="signupConfirmPassword" class="form-input" placeholder="Confirm your password">
                            <button class="password-toggle" type="button" onclick="togglePassword('signupConfirmPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="remember-me">
                            <input type="checkbox" id="acceptTerms" class="checkbox">
                            <span>I agree to the Terms & Privacy</span>
                        </label>
                    </div>
                    
                    <button class="auth-btn" onclick="signUpWithEmail()">Create Account</button>
                    
                    <div class="auth-divider">
                        <span>Or sign up with</span>
                    </div>
                    
                    <div class="social-auth">
                        <button class="social-btn google-btn" onclick="signUpWithGoogle()">
                            <i class="fab fa-google"></i>
                        </button>
                        <button class="social-btn microsoft-btn" onclick="signUpWithMicrosoft()">
                            <i class="fab fa-microsoft"></i>
                        </button>
                    </div>
                    
                    <p class="auth-footer">
                        Already have an account? <a href="#" onclick="switchAuthTab('signin')">Sign In</a>
                    </p>
                </div>

                <!-- OTP Form -->
                <div id="otpForm" class="auth-form-content" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Verification Code</label>
                        <input type="text" id="otpCode" class="form-input" placeholder="Enter the 6-digit code sent to your email">
                    </div>
                    
                    <button class="auth-btn" onclick="verifyOTP()">Verify Code</button>
                    
                    <p class="auth-footer">
                        Didn't receive the code? <a href="#" onclick="resendOTP()">Resend</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Interface -->
    <div id="chatContainer" class="chat-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="sidebar-logo-text">Cyanix AI</div>
                </div>
            </div>
            
            <div class="sidebar-content">
                <button class="new-chat-btn" onclick="newChat()">
                    <i class="fas fa-plus"></i>
                    New Chat
                </button>
                
                <div class="sidebar-section">
                    <div class="sidebar-title">Chat History</div>
                    <div id="chatHistory">
                        <!-- Chat history will be loaded here -->
                        <div class="sidebar-btn" onclick="loadChat('example1')">
                            <i class="fas fa-comment sidebar-btn-icon"></i>
                            <span>Python Code Help</span>
                        </div>
                        <div class="sidebar-btn" onclick="loadChat('example2')">
                            <i class="fas fa-comment sidebar-btn-icon"></i>
                            <span>Business Ideas</span>
                        </div>
                    </div>
                </div>
                
                <div class="sidebar-section">
                    <div class="sidebar-title">AI Settings</div>
                    <div class="sidebar-btn" onclick="openModelModal()">
                        <i class="fas fa-brain sidebar-btn-icon"></i>
                        <span>Change AI Model</span>
                    </div>
                </div>
                
                <div id="aiModelStatus" class="ai-model-status">
                    <div class="ai-model-indicator"></div>
                    <div class="ai-model-text" id="modelStatusText">Cyanix Pro â€¢ Ready</div>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-profile" onclick="showUserMenu()">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-info">
                        <div class="user-name" id="userName">User</div>
                        <div class="user-email" id="userEmail">user@example.com</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Chat Area -->
        <div class="main-chat">
            <div class="chat-header">
                <div class="chat-title" id="chatTitle">New Chat</div>
                <div class="chat-header-actions">
                    <button class="header-btn" onclick="openModelModal()">
                        <i class="fas fa-brain"></i>
                        AI Model
                    </button>
                    <button class="header-btn" onclick="exportConversation()">
                        <i class="fas fa-download"></i>
                        Export
                    </button>
                    <button class="header-btn" onclick="clearChat()">
                        <i class="fas fa-trash"></i>
                        Clear
                    </button>
                </div>
            </div>
            
            <div class="messages-container" id="messagesContainer">
                <!-- Welcome Screen -->
                <div id="welcomeScreen" class="welcome-screen">
                    <div class="welcome-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h1 class="welcome-title">Welcome to Cyanix AI</h1>
                    <p class="welcome-subtitle">
                        No API keys required - powered by Cyanix's advanced AI infrastructure. 
                        I can help with writing, analysis, coding, creative tasks, and much more.
                    </p>
                    
                    <div class="example-prompts">
                        <div class="example-prompt" onclick="useExample('brainstorm')">
                            <div class="example-title">
                                <i class="fas fa-lightbulb"></i>
                                Brainstorm ideas
                            </div>
                            <div class="example-text">"Help me brainstorm creative project ideas for a tech startup"</div>
                        </div>
                        <div class="example-prompt" onclick="useExample('explain')">
                            <div class="example-title">
                                <i class="fas fa-book"></i>
                                Explain concepts
                            </div>
                            <div class="example-text">"Explain quantum computing in simple terms"</div>
                        </div>
                        <div class="example-prompt" onclick="useExample('code')">
                            <div class="example-title">
                                <i class="fas fa-code"></i>
                                Write code
                            </div>
                            <div class="example-text">"Write a Python function to sort a list using quicksort"</div>
                        </div>
                        <div class="example-prompt" onclick="useExample('analyze')">
                            <div class="example-title">
                                <i class="fas fa-chart-line"></i>
                                Analyze data
                            </div>
                            <div class="example-text">"Analyze the pros and cons of renewable energy sources"</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="input-container">
                <div class="input-wrapper">
                    <div class="attached-files-preview" id="attachedFilesPreview">
                        <!-- Attached files will be shown here -->
                    </div>
                    <textarea 
                        id="chatInput" 
                        class="chat-input" 
                        placeholder="Message Cyanix AI..."
                        rows="1"
                        oninput="autoResizeInput(this)"
                        onkeydown="handleKeyDown(event)"
                    ></textarea>
                    <div class="input-buttons">
                        <button class="input-btn" onclick="openFileAttachmentModal()" title="Attach Files">
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <button class="input-btn send" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== FIREBASE CONFIGURATION ====================
        const firebaseConfig = {
            apiKey: "AIzaSyD-norrA3MlCj8j1rHk0IJp6OGjr8nvk1Y",
            authDomain: "cyanix-ai-web.firebaseapp.com",
            projectId: "cyanix-ai-web",
            storageBucket: "cyanix-ai-web.firebasestorage.app",
            messagingSenderId: "838002567182",
            appId: "1:838002567182:web:d445a9a5bcad1ac5df745f",
            measurementId: "G-R8VED4GBHY"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // ==================== APP STATE ====================
        let currentUser = null;
        let currentChatId = null;
        let isVerifyingOTP = false;
        let tempEmail = null;
        let selectedModel = 'cyanix-pro';
        let conversationHistory = [];
        let attachedFiles = [];
        let currentPreviewFile = null;

        // Supported file types
        const SUPPORTED_FILE_TYPES = {
            'image/jpeg': { icon: 'fas fa-image', color: '#FF6B6B' },
            'image/jpg': { icon: 'fas fa-image', color: '#FF6B6B' },
            'image/png': { icon: 'fas fa-image', color: '#4ECDC4' },
            'image/gif': { icon: 'fas fa-photo-video', color: '#45B7D1' },
            'application/pdf': { icon: 'fas fa-file-pdf', color: '#FF4757' },
            'text/plain': { icon: 'fas fa-file-alt', color: '#2ED573' },
            'text/html': { icon: 'fas fa-code', color: '#3742FA' },
            'application/msword': { icon: 'fas fa-file-word', color: '#1B98F5' },
            'application/vnd.openxmlformats-officedocument.wordprocessingml.document': { icon: 'fas fa-file-word', color: '#1B98F5' },
            'default': { icon: 'fas fa-file', color: '#747D8C' }
        };

        // ==================== CYANIX API CONFIGURATION ====================
        const CYANIX_API_CONFIG = {
            BASE_URL: 'https://api.cyanix.ai/v1',
            ENDPOINTS: {
                CHAT: '/chat/completions',
                VISION: '/vision/analyze',
                MODELS: '/models'
            },
            DEFAULT_MODEL: 'cyanix-pro'
        };

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
            setupFileHandlers();
        });

        function initApp() {
            // Animate loading progress
            const loadingProgress = document.getElementById('loadingProgress');
            let progress = 0;
            const loadingInterval = setInterval(() => {
                progress += Math.random() * 20;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(loadingInterval);
                }
                loadingProgress.style.width = progress + '%';
            }, 200);

            // Hide splash screen after delay
            setTimeout(() => {
                document.getElementById('splashScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('splashScreen').style.display = 'none';
                    
                    // Check Firebase auth state
                    auth.onAuthStateChanged((user) => {
                        if (user) {
                            if (isVerifyingOTP) {
                                // Do nothing, waiting for OTP verification
                            } else {
                                handleUserSignedIn(user);
                            }
                        } else {
                            handleUserSignedOut();
                        }
                    });
                    
                }, 500);
            }, 3000);
        }

        function setupFileHandlers() {
            // File input change handler
            const fileInput = document.getElementById('fileInput');
            fileInput.addEventListener('change', handleFileSelect);
            
            // Drag and drop handlers
            const fileDropZone = document.getElementById('fileDropZone');
            
            fileDropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileDropZone.classList.add('drag-over');
            });
            
            fileDropZone.addEventListener('dragleave', () => {
                fileDropZone.classList.remove('drag-over');
            });
            
            fileDropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                fileDropZone.classList.remove('drag-over');
                
                const files = e.dataTransfer.files;
                handleFiles(files);
            });
            
            // Click to trigger file input
            fileDropZone.addEventListener('click', () => {
                fileInput.click();
            });
        }

        function handleUserSignedIn(user) {
            currentUser = {
                uid: user.uid,
                name: user.displayName || user.email.split('@')[0],
                email: user.email,
                avatar: getAvatarInitials(user.displayName || user.email),
                photoURL: user.photoURL,
                emailVerified: user.emailVerified
            };
            
            showChatInterface();
            loadUserSettings();
            showToast('Welcome to Cyanix AI!', 'success');
        }

        function handleUserSignedOut() {
            currentUser = null;
            attachedFiles = [];
            updateAttachedFilesPreview();
            showAuth();
        }

        // ==================== FILE ATTACHMENT FUNCTIONS ====================
        function openFileAttachmentModal() {
            document.getElementById('fileAttachmentModal').classList.add('active');
        }

        function closeFileAttachmentModal() {
            document.getElementById('fileAttachmentModal').classList.remove('active');
        }

        function handleFileSelect(e) {
            const files = e.target.files;
            handleFiles(files);
        }

        function handleFiles(files) {
            if (!files || files.length === 0) return;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // Validate file type
                if (!isFileTypeSupported(file)) {
                    showToast(`File type not supported: ${file.name}`, 'warning');
                    continue;
                }
                
                // Validate file size (max 10MB)
                if (file.size > 10 * 1024 * 1024) {
                    showToast(`File too large (max 10MB): ${file.name}`, 'warning');
                    continue;
                }
                
                // Check if file already attached
                if (attachedFiles.some(f => f.name === file.name && f.size === file.size)) {
                    showToast(`File already attached: ${file.name}`, 'info');
                    continue;
                }
                
                // Add to attached files
                attachedFiles.push(file);
            }
            
            updateAttachedFilesPreview();
            updateSelectedFilesList();
        }

        function isFileTypeSupported(file) {
            const supportedTypes = [
                'image/jpeg', 'image/jpg', 'image/png', 'image/gif',
                'application/pdf', 'text/plain', 'text/html',
                'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
            ];
            
            return supportedTypes.includes(file.type);
        }

        function updateAttachedFilesPreview() {
            const container = document.getElementById('attachedFilesPreview');
            
            if (attachedFiles.length === 0) {
                container.innerHTML = '';
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'flex';
            container.innerHTML = '';
            
            attachedFiles.forEach((file, index) => {
                const fileInfo = getFileInfo(file);
                const fileElement = document.createElement('div');
                fileElement.className = 'attached-file-item';
                fileElement.innerHTML = `
                    <i class="${fileInfo.icon}" style="color: ${fileInfo.color};"></i>
                    <span>${file.name}</span>
                    <button class="remove-file" onclick="removeAttachedFile(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(fileElement);
            });
        }

        function updateSelectedFilesList() {
            const container = document.getElementById('selectedFilesList');
            container.innerHTML = '';
            
            if (attachedFiles.length === 0) {
                container.innerHTML = '<p style="color: var(--cyan-light); opacity: 0.7; text-align: center; padding: 20px;">No files selected</p>';
                return;
            }
            
            attachedFiles.forEach((file, index) => {
                const fileInfo = getFileInfo(file);
                const fileSize = formatFileSize(file.size);
                
                const fileElement = document.createElement('div');
                fileElement.className = 'selected-file-item';
                fileElement.innerHTML = `
                    <div class="selected-file-info">
                        <i class="${fileInfo.icon} selected-file-icon" style="color: ${fileInfo.color};"></i>
                        <div class="selected-file-details">
                            <div class="selected-file-name">${file.name}</div>
                            <div class="selected-file-size">${fileSize}</div>
                        </div>
                    </div>
                    <button class="selected-file-remove" onclick="removeAttachedFile(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(fileElement);
            });
        }

        function removeAttachedFile(index) {
            attachedFiles.splice(index, 1);
            updateAttachedFilesPreview();
            updateSelectedFilesList();
        }

        function getFileInfo(file) {
            return SUPPORTED_FILE_TYPES[file.type] || SUPPORTED_FILE_TYPES['default'];
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        async function uploadSelectedFiles() {
            if (attachedFiles.length === 0) {
                showToast('No files selected', 'warning');
                return;
            }

            // Create conversation if doesn't exist
            if (!currentChatId) {
                const conversationRef = await db.collection('conversations').add({
                    userId: currentUser.uid,
                    title: 'Files Upload',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                currentChatId = conversationRef.id;
                document.getElementById('chatTitle').textContent = 'Files Upload';
            }

            // Upload each file
            const uploadPromises = attachedFiles.map(async (file) => {
                try {
                    // Generate unique filename
                    const timestamp = Date.now();
                    const randomString = Math.random().toString(36).substring(2, 15);
                    const fileName = `${timestamp}_${randomString}_${file.name}`;
                    
                    // Create storage reference
                    const storageRef = storage.ref();
                    const fileRef = storageRef.child(`conversations/${currentChatId}/${fileName}`);
                    
                    // Upload file
                    const uploadTask = fileRef.put(file);
                    
                    // Create upload progress UI
                    const fileIndex = attachedFiles.indexOf(file);
                    createUploadProgress(fileIndex, file);
                    
                    // Wait for upload to complete
                    const snapshot = await uploadTask;
                    const downloadURL = await snapshot.ref.getDownloadURL();
                    
                    // Save file info to Firestore
                    const fileData = {
                        conversationId: currentChatId,
                        userId: currentUser.uid,
                        fileName: file.name,
                        fileType: file.type,
                        fileSize: file.size,
                        downloadURL: downloadURL,
                        storagePath: snapshot.ref.fullPath,
                        uploadedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    await db.collection('files').add(fileData);
                    
                    // Update UI
                    updateUploadProgress(fileIndex, 100, true);
                    
                    return fileData;
                    
                } catch (error) {
                    console.error('Error uploading file:', error);
                    showToast(`Error uploading ${file.name}: ${error.message}`, 'error');
                    updateUploadProgress(attachedFiles.indexOf(file), 0, false);
                    throw error;
                }
            });

            try {
                showToast('Uploading files...', 'info');
                const uploadedFiles = await Promise.all(uploadPromises);
                
                // Clear attached files
                attachedFiles = [];
                updateAttachedFilesPreview();
                updateSelectedFilesList();
                
                showToast('Files uploaded successfully!', 'success');
                closeFileAttachmentModal();
                
                // Add message with file attachments
                const messageContent = `I've uploaded ${uploadedFiles.length} file(s).`;
                addMessageToUI(messageContent, 'user', uploadedFiles);
                
            } catch (error) {
                showToast('Some files failed to upload', 'error');
            }
        }

        function createUploadProgress(fileIndex, file) {
            const container = document.getElementById('selectedFilesList');
            const fileItems = container.querySelectorAll('.selected-file-item');
            
            if (fileItems[fileIndex]) {
                const progressBar = document.createElement('div');
                progressBar.className = 'file-upload-progress';
                progressBar.innerHTML = '<div class="file-upload-progress-bar" style="width: 0%"></div>';
                fileItems[fileIndex].appendChild(progressBar);
            }
        }

        function updateUploadProgress(fileIndex, progress, success) {
            const container = document.getElementById('selectedFilesList');
            const fileItems = container.querySelectorAll('.selected-file-item');
            
            if (fileItems[fileIndex]) {
                const progressBar = fileItems[fileIndex].querySelector('.file-upload-progress-bar');
                if (progressBar) {
                    progressBar.style.width = `${progress}%`;
                    progressBar.style.background = success ? 
                        'linear-gradient(90deg, var(--green-neon), var(--cyan-primary))' :
                        'linear-gradient(90deg, var(--cyan-secondary), var(--cyan-primary))';
                }
            }
        }

        // ==================== FILE PREVIEW FUNCTIONS ====================
        function openFilePreviewModal(fileData) {
            currentPreviewFile = fileData;
            const modal = document.getElementById('filePreviewModal');
            const content = document.getElementById('filePreviewContent');
            const downloadBtn = document.getElementById('downloadPreviewBtn');
            
            modal.classList.add('active');
            content.innerHTML = '';
            
            // Show loading
            content.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div class="typing-indicator" style="justify-content: center;">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                    <p style="color: var(--cyan-light); margin-top: 20px;">Loading file preview...</p>
                </div>
            `;
            
            // Set download button
            downloadBtn.onclick = () => downloadFile(fileData);
            
            // Load file content based on type
            if (fileData.fileType.startsWith('image/')) {
                loadImagePreview(fileData.downloadURL);
            } else if (fileData.fileType === 'application/pdf') {
                loadPDFPreview(fileData.downloadURL);
            } else if (fileData.fileType.startsWith('text/')) {
                loadTextPreview(fileData.downloadURL);
            } else {
                loadGenericPreview(fileData);
            }
        }

        function closeFilePreviewModal() {
            document.getElementById('filePreviewModal').classList.remove('active');
            currentPreviewFile = null;
        }

        function loadImagePreview(url) {
            const content = document.getElementById('filePreviewContent');
            content.innerHTML = `
                <img src="${url}" class="file-preview-image" alt="Preview">
                <div class="file-preview-info">
                    <h4><i class="fas fa-info-circle"></i> File Information</h4>
                    <p><strong>Type:</strong> Image</p>
                    <p><strong>Size:</strong> ${formatFileSize(currentPreviewFile.fileSize)}</p>
                    <p><strong>Name:</strong> ${currentPreviewFile.fileName}</p>
                </div>
            `;
        }

        function loadPDFPreview(url) {
            const content = document.getElementById('filePreviewContent');
            content.innerHTML = `
                <iframe src="${url}" style="width: 100%; height: 400px; border: none; border-radius: 10px;"></iframe>
                <div class="file-preview-info">
                    <h4><i class="fas fa-info-circle"></i> File Information</h4>
                    <p><strong>Type:</strong> PDF Document</p>
                    <p><strong>Size:</strong> ${formatFileSize(currentPreviewFile.fileSize)}</p>
                    <p><strong>Name:</strong> ${currentPreviewFile.fileName}</p>
                    <p><em>Note: PDF preview may not work in all browsers. Click download to save the file.</em></p>
                </div>
            `;
        }

        async function loadTextPreview(url) {
            try {
                const response = await fetch(url);
                const text = await response.text();
                
                const content = document.getElementById('filePreviewContent');
                content.innerHTML = `
                    <div class="file-preview-text">${escapeHtml(text.substring(0, 10000))}${text.length > 10000 ? '\n\n... (truncated)' : ''}</div>
                    <div class="file-preview-info">
                        <h4><i class="fas fa-info-circle"></i> File Information</h4>
                        <p><strong>Type:</strong> Text Document</p>
                        <p><strong>Size:</strong> ${formatFileSize(currentPreviewFile.fileSize)}</p>
                        <p><strong>Name:</strong> ${currentPreviewFile.fileName}</p>
                        <p><strong>Characters:</strong> ${text.length}</p>
                    </div>
                `;
            } catch (error) {
                showToast('Error loading text file', 'error');
                loadGenericPreview(currentPreviewFile);
            }
        }

        function loadGenericPreview(fileData) {
            const content = document.getElementById('filePreviewContent');
            content.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <i class="fas fa-file" style="font-size: 80px; color: var(--cyan-primary); margin-bottom: 20px;"></i>
                    <h4 style="color: var(--cyan-primary); margin-bottom: 10px;">${fileData.fileName}</h4>
                    <p style="color: var(--cyan-light);">This file type cannot be previewed directly.</p>
                </div>
                <div class="file-preview-info">
                    <h4><i class="fas fa-info-circle"></i> File Information</h4>
                    <p><strong>Type:</strong> ${fileData.fileType}</p>
                    <p><strong>Size:</strong> ${formatFileSize(fileData.fileSize)}</p>
                    <p><strong>Name:</strong> ${fileData.fileName}</p>
                    <p>Click download to save the file to your device.</p>
                </div>
            `;
        }

        function downloadPreviewFile() {
            if (currentPreviewFile) {
                downloadFile(currentPreviewFile);
            }
        }

        function downloadFile(fileData) {
            const a = document.createElement('a');
            a.href = fileData.downloadURL;
            a.download = fileData.fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            showToast(`Downloading ${fileData.fileName}...`, 'success');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ==================== CYANIX API FUNCTIONS ====================
        async function callCyanixAPI(message, files = []) {
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Check for image analysis requests
            if (selectedModel === 'cyanix-vision' && files.length > 0 && files.some(f => f.fileType.startsWith('image/'))) {
                return simulateVisionAnalysis(files);
            }
            
            // Regular text response based on model
            return simulateTextResponse(message, selectedModel);
        }

        function simulateVisionAnalysis(files) {
            const imageFiles = files.filter(f => f.fileType.startsWith('image/'));
            let response = `I can see ${imageFiles.length} image(s).\n\n`;
            
            imageFiles.forEach((file, index) => {
                response += `Image ${index + 1} (${file.fileName}):\n`;
                
                // Simulate different types of image analysis
                const analyses = [
                    "This appears to be a high-quality image with good composition.",
                    "The image shows interesting visual elements that could be analyzed further.",
                    "I can identify various features in this image that might be relevant to your query.",
                    "This image contains visual data that could be useful for analysis or creative projects."
                ];
                
                const randomAnalysis = analyses[Math.floor(Math.random() * analyses.length)];
                response += `${randomAnalysis}\n\n`;
            });
            
            response += "If you have specific questions about these images, feel free to ask!";
            return response;
        }

        function simulateTextResponse(message, model) {
            // Simulate different model personalities
            const modelResponses = {
                'cyanix-pro': `I've analyzed your query "${message.substring(0, 50)}..." and here's my comprehensive response:\n\nAs a sophisticated AI model, I can provide detailed analysis, creative solutions, and expert insights on this topic. The key points to consider are...`,
                'cyanix-flash': `Here's a quick response to your query:\n\nBased on the information provided, I recommend considering the following approach. This should help you achieve your goals efficiently.`,
                'cyanix-advanced': `As an expert AI model, I can provide specialized analysis on this topic.\n\nFrom a technical perspective, the most important factors to consider are...`
            };
            
            const baseResponse = modelResponses[model] || modelResponses['cyanix-pro'];
            
            // Add some dynamic content based on message
            if (message.toLowerCase().includes('code') || message.toLowerCase().includes('program')) {
                return `${baseResponse}\n\nHere's a code example that might help:\n\`\`\`python\ndef solution():\n    # Your implementation here\n    return "Result"\n\`\`\``;
            } else if (message.toLowerCase().includes('business') || message.toLowerCase().includes('startup')) {
                return `${baseResponse}\n\nKey business considerations:\n1. Market analysis\n2. Competitive advantage\n3. Revenue model\n4. Scalability factors`;
            } else if (message.toLowerCase().includes('creative') || message.toLowerCase().includes('idea')) {
                return `${baseResponse}\n\nCreative suggestions:\nâ€¢ Brainstorm multiple approaches\nâ€¢ Consider unconventional solutions\nâ€¢ Combine different concepts\nâ€¢ Test and iterate`;
            }
            
            return `${baseResponse}\n\nIs there anything specific you'd like me to elaborate on?`;
        }

        function getModelDisplayName(model) {
            const modelNames = {
                'cyanix-pro': 'Cyanix Pro',
                'cyanix-flash': 'Cyanix Flash',
                'cyanix-vision': 'Cyanix Vision',
                'cyanix-advanced': 'Cyanix Advanced'
            };
            return modelNames[model] || 'Cyanix Pro';
        }

        function updateModelStatus() {
            const indicator = document.querySelector('.ai-model-indicator');
            const text = document.getElementById('modelStatusText');
            
            indicator.style.background = 'var(--green-neon)';
            indicator.style.boxShadow = '0 0 10px var(--green-neon)';
            indicator.style.animation = 'pulse 2s infinite';
            text.textContent = `${getModelDisplayName(selectedModel)} â€¢ Ready`;
        }

        // ==================== MODEL MANAGEMENT ====================
        function openModelModal() {
            document.getElementById('modelModal').classList.add('active');
            highlightSelectedModel();
        }

        function closeModelModal() {
            document.getElementById('modelModal').classList.remove('active');
        }

        function selectModel(model) {
            const modelBtns = document.querySelectorAll('.model-btn');
            modelBtns.forEach(btn => {
                if (btn.dataset.model === model) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            selectedModel = model;
        }

        function highlightSelectedModel() {
            const modelBtns = document.querySelectorAll('.model-btn');
            modelBtns.forEach(btn => {
                if (btn.dataset.model === selectedModel) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        async function saveModelSelection() {
            if (currentUser) {
                try {
                    await db.collection('users').doc(currentUser.uid).set({
                        settings: {
                            aiModel: selectedModel,
                            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                        }
                    }, { merge: true });

                    updateModelStatus();
                    closeModelModal();
                    showToast(`AI model changed to ${getModelDisplayName(selectedModel)}`, 'success');
                } catch (error) {
                    console.error('Error saving model selection:', error);
                    showToast('Error saving model selection', 'error');
                }
            } else {
                updateModelStatus();
                closeModelModal();
                showToast(`AI model changed to ${getModelDisplayName(selectedModel)}`, 'success');
            }
        }

        async function loadUserSettings() {
            if (!currentUser) return;

            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    const data = userDoc.data();
                    if (data.settings && data.settings.aiModel) {
                        selectedModel = data.settings.aiModel;
                        updateModelStatus();
                    }
                }
            } catch (error) {
                console.error('Error loading user settings:', error);
            }
        }

        // ==================== AUTH FUNCTIONS ====================
        function switchAuthTab(tab) {
            const signinForm = document.getElementById('signinForm');
            const signupForm = document.getElementById('signupForm');
            const otpForm = document.getElementById('otpForm');
            const authTabs = document.getElementById('authTabs');
            
            if (tab === 'signin') {
                authTabs.classList.remove('signup-active');
                signinForm.style.display = 'block';
                signupForm.style.display = 'none';
                otpForm.style.display = 'none';
            } else {
                authTabs.classList.add('signup-active');
                signinForm.style.display = 'none';
                signupForm.style.display = 'block';
                otpForm.style.display = 'none';
            }
        }

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const toggle = input.parentElement.querySelector('.password-toggle i');
            
            if (input.type === 'password') {
                input.type = 'text';
                toggle.classList.remove('fa-eye');
                toggle.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                toggle.classList.remove('fa-eye-slash');
                toggle.classList.add('fa-eye');
            }
        }

        async function signInWithEmail() {
            const email = document.getElementById('signinEmail').value.trim();
            const password = document.getElementById('signinPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            if (!validateEmail(email)) {
                showToast('Please enter a valid email address', 'error');
                return;
            }
            
            if (password.length < 6) {
                showToast('Password must be at least 6 characters', 'error');
                return;
            }
            
            // Set persistence based on remember me
            const persistence = rememberMe ? 
                firebase.auth.Auth.Persistence.LOCAL : 
                firebase.auth.Auth.Persistence.SESSION;
            
            try {
                await auth.setPersistence(persistence);
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // Generate 6-digit OTP
                const otp = Math.floor(100000 + Math.random() * 900000).toString();
                const otpTime = new Date();

                // Store OTP in Firestore
                await db.collection('users').doc(user.uid).update({
                    tempOtp: otp,
                    tempOtpTime: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Store temp email for resend
                tempEmail = email;

                // Set verifying flag
                isVerifyingOTP = true;

                // Switch to OTP form
                document.getElementById('signinForm').style.display = 'none';
                document.getElementById('otpForm').style.display = 'block';

                showToast('Verification code sent to your email', 'success');
            } catch (error) {
                showToast(getFirebaseError(error), 'error');
            }
        }

        async function verifyOTP() {
            const code = document.getElementById('otpCode').value.trim();

            if (code.length !== 6) {
                showToast('Please enter a 6-digit code', 'error');
                return;
            }

            try {
                const user = auth.currentUser;
                if (!user) {
                    showToast('Session expired. Please sign in again', 'error');
                    switchAuthTab('signin');
                    return;
                }

                const userDocSnap = await db.collection('users').doc(user.uid).get();
                const data = userDocSnap.data();

                if (!data || !data.tempOtp) {
                    showToast('No verification code found. Please sign in again', 'error');
                    auth.signOut();
                    return;
                }

                const savedOtp = data.tempOtp;
                const otpTime = data.tempOtpTime.toDate();
                const now = new Date();

                if (now - otpTime > 5 * 60 * 1000) { // 5 minutes expiration
                    showToast('Verification code expired. Please sign in again', 'error');
                    auth.signOut();
                    return;
                }

                if (savedOtp === code) {
                    // Clear temp OTP
                    await userDocSnap.ref.update({
                        tempOtp: firebase.firestore.FieldValue.delete(),
                        tempOtpTime: firebase.firestore.FieldValue.delete()
                    });

                    // Proceed to signed in state
                    isVerifyingOTP = false;
                    handleUserSignedIn(user);
                    showToast('Verification successful!', 'success');
                } else {
                    showToast('Invalid verification code', 'error');
                }
            } catch (error) {
                showToast('Error verifying code: ' + error.message, 'error');
            }
        }

        async function resendOTP() {
            try {
                const user = auth.currentUser;
                if (!user || !tempEmail) return;

                const otp = Math.floor(100000 + Math.random() * 900000).toString();
                const otpTime = new Date();

                await db.collection('users').doc(user.uid).update({
                    tempOtp: otp,
                    tempOtpTime: firebase.firestore.FieldValue.serverTimestamp()
                });

                showToast('New code sent to your email', 'success');
            } catch (error) {
                showToast('Error resending code', 'error');
            }
        }

        async function signUpWithEmail() {
            const name = document.getElementById('signupName').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            const acceptTerms = document.getElementById('acceptTerms').checked;
            
            // Validation
            if (!name) {
                showToast('Please enter your name', 'error');
                return;
            }
            
            if (!validateEmail(email)) {
                showToast('Please enter a valid email address', 'error');
                return;
            }
            
            if (password.length < 8) {
                showToast('Password must be at least 8 characters', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }
            
            if (!acceptTerms) {
                showToast('Please accept the terms and privacy policy', 'error');
                return;
            }
            
            try {
                // Create user with Firebase
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Update profile with name
                await user.updateProfile({
                    displayName: name
                });
                
                // Send email verification
                await user.sendEmailVerification();
                
                // Save user data to Firestore
                await db.collection('users').doc(user.uid).set({
                    name: name,
                    email: email,
                    avatar: getAvatarInitials(name),
                    plan: 'free',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    settings: {
                        emailNotifications: true,
                        marketingEmails: false,
                        saveHistory: true,
                        aiModel: 'cyanix-pro',
                        responseLength: 'medium'
                    }
                });
                
                showToast('Account created! Please check your email for verification.', 'success');
            } catch (error) {
                showToast(getFirebaseError(error), 'error');
            }
        }

        async function signInWithGoogle() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('profile');
                provider.addScope('email');
                
                const result = await auth.signInWithPopup(provider);
                const user = result.user;
                
                // Save user data to Firestore if new user
                await db.collection('users').doc(user.uid).set({
                    name: user.displayName,
                    email: user.email,
                    avatar: getAvatarInitials(user.displayName),
                    photoURL: user.photoURL,
                    plan: 'free',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    provider: 'google',
                    settings: {
                        emailNotifications: true,
                        marketingEmails: false,
                        saveHistory: true,
                        aiModel: 'cyanix-pro',
                        responseLength: 'medium'
                    }
                }, { merge: true });
                
                showToast('Signed in with Google!', 'success');
            } catch (error) {
                showToast(getFirebaseError(error), 'error');
            }
        }

        async function signInWithMicrosoft() {
            try {
                const provider = new firebase.auth.OAuthProvider('microsoft.com');
                provider.addScope('profile');
                provider.addScope('email');
                provider.setCustomParameters({
                    tenant: 'common'
                });
                
                const result = await auth.signInWithPopup(provider);
                const user = result.user;
                
                // Save user data to Firestore if new user
                await db.collection('users').doc(user.uid).set({
                    name: user.displayName,
                    email: user.email,
                    avatar: getAvatarInitials(user.displayName),
                    photoURL: user.photoURL,
                    plan: 'free',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    provider: 'microsoft',
                    settings: {
                        emailNotifications: true,
                        marketingEmails: false,
                        saveHistory: true,
                        aiModel: 'cyanix-pro',
                        responseLength: 'medium'
                    }
                }, { merge: true });
                
                showToast('Signed in with Microsoft!', 'success');
            } catch (error) {
                showToast(getFirebaseError(error), 'error');
            }
        }

        function signUpWithGoogle() {
            signInWithGoogle();
        }

        function signUpWithMicrosoft() {
            signInWithMicrosoft();
        }

        function showForgotPassword() {
            const email = prompt("Enter your email to reset password:");
            if (email && validateEmail(email)) {
                auth.sendPasswordResetEmail(email)
                    .then(() => {
                        showToast('Password reset email sent!', 'success');
                    })
                    .catch((error) => {
                        showToast(getFirebaseError(error), 'error');
                    });
            } else if (email) {
                showToast('Please enter a valid email', 'error');
            }
        }

        // ==================== UI FUNCTIONS ====================
        function showChatInterface() {
            document.getElementById('authContainer').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('authContainer').style.display = 'none';
                document.getElementById('chatContainer').classList.add('active');
                
                // Update user info
                if (currentUser) {
                    document.getElementById('userName').textContent = currentUser.name;
                    document.getElementById('userEmail').textContent = currentUser.email;
                    document.getElementById('userAvatar').textContent = currentUser.avatar;
                }
            }, 500);
        }

        function showAuth() {
            document.getElementById('chatContainer').classList.remove('active');
            document.getElementById('authContainer').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('authContainer').style.opacity = '1';
            }, 10);
            document.getElementById('otpForm').style.display = 'none';
            switchAuthTab('signin');
        }

        function newChat() {
            currentChatId = null;
            conversationHistory = [];
            attachedFiles = [];
            updateAttachedFilesPreview();
            document.getElementById('messagesContainer').innerHTML = '';
            document.getElementById('chatTitle').textContent = 'New Chat';
            
            // Show welcome screen
            const welcomeScreen = document.getElementById('welcomeScreen').cloneNode(true);
            welcomeScreen.style.display = 'block';
            document.getElementById('messagesContainer').appendChild(welcomeScreen);
        }

        function useExample(type) {
            const examples = {
                brainstorm: "Help me brainstorm creative project ideas for a tech startup that combines AI with environmental sustainability.",
                explain: "Explain quantum computing in simple terms. How does it differ from classical computing, and what are its potential applications?",
                code: "Write a Python function to sort a list using quicksort algorithm. Include comments explaining each step and provide example usage.",
                analyze: "Analyze the pros and cons of renewable energy sources (solar, wind, hydro) compared to fossil fuels. Consider factors like cost, efficiency, environmental impact, and scalability."
            };

            document.getElementById('chatInput').value = examples[type];
            autoResizeInput(document.getElementById('chatInput'));
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message && attachedFiles.length === 0) return;
            
            // Hide welcome screen
            document.getElementById('welcomeScreen')?.remove();
            
            // Handle file uploads if any
            let uploadedFiles = [];
            if (attachedFiles.length > 0) {
                uploadedFiles = await uploadFilesToStorage(attachedFiles);
                attachedFiles = [];
                updateAttachedFilesPreview();
            }
            
            // Add user message
            addMessageToUI(message, 'user', uploadedFiles);
            conversationHistory.push({ role: 'user', content: message });
            
            // Clear input
            input.value = '';
            autoResizeInput(input);
            
            // Show typing indicator if there's a text message
            if (message) {
                showTypingIndicator();
                
                try {
                    // Create conversation in Firestore if doesn't exist
                    if (!currentChatId) {
                        const conversationRef = await db.collection('conversations').add({
                            userId: currentUser.uid,
                            title: message.substring(0, 50) + (message.length > 50 ? '...' : ''),
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        currentChatId = conversationRef.id;
                        document.getElementById('chatTitle').textContent = message.substring(0, 30) + (message.length > 30 ? '...' : '');
                    }
                    
                    // Save user message
                    await db.collection('messages').add({
                        conversationId: currentChatId,
                        userId: currentUser.uid,
                        content: message,
                        sender: 'user',
                        files: uploadedFiles.map(f => ({
                            fileName: f.fileName,
                            fileType: f.fileType,
                            fileSize: f.fileSize,
                            downloadURL: f.downloadURL
                        })),
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Update conversation title if it's the first message
                    if (document.getElementById('chatTitle').textContent === 'New Chat') {
                        await db.collection('conversations').doc(currentChatId).update({
                            title: message.substring(0, 30) + (message.length > 30 ? '...' : ''),
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                    
                    // Generate AI response using Cyanix API if there's a message
                    let aiResponse = null;
                    if (message) {
                        try {
                            aiResponse = await callCyanixAPI(message, uploadedFiles);
                        } catch (apiError) {
                            console.error('Cyanix API failed:', apiError);
                            hideTypingIndicator();
                            showToast(`API Error: ${apiError.message}`, 'error');
                            return;
                        }
                    }
                    
                    hideTypingIndicator();
                    
                    // Add AI response if there is one
                    if (aiResponse) {
                        addMessageToUI(aiResponse, 'assistant');
                        conversationHistory.push({ role: 'assistant', content: aiResponse });
                        
                        // Save AI response
                        await db.collection('messages').add({
                            conversationId: currentChatId,
                            userId: currentUser.uid,
                            content: aiResponse,
                            sender: 'assistant',
                            timestamp: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                    
                } catch (error) {
                    console.error('Error sending message:', error);
                    hideTypingIndicator();
                    showToast('Error: ' + error.message, 'error');
                }
            }
        }

        async function uploadFilesToStorage(files) {
            if (!currentChatId) {
                const conversationRef = await db.collection('conversations').add({
                    userId: currentUser.uid,
                    title: 'Files Upload',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                currentChatId = conversationRef.id;
                document.getElementById('chatTitle').textContent = 'Files Upload';
            }

            const uploadedFiles = [];
            
            for (const file of files) {
                try {
                    // Generate unique filename
                    const timestamp = Date.now();
                    const randomString = Math.random().toString(36).substring(2, 15);
                    const fileName = `${timestamp}_${randomString}_${file.name}`;
                    
                    // Create storage reference
                    const storageRef = storage.ref();
                    const fileRef = storageRef.child(`conversations/${currentChatId}/${fileName}`);
                    
                    // Upload file
                    const uploadTask = fileRef.put(file);
                    
                    // Wait for upload to complete
                    const snapshot = await uploadTask;
                    const downloadURL = await snapshot.ref.getDownloadURL();
                    
                    // Create file data object
                    const fileData = {
                        fileName: file.name,
                        fileType: file.type,
                        fileSize: file.size,
                        downloadURL: downloadURL,
                        storagePath: snapshot.ref.fullPath
                    };
                    
                    uploadedFiles.push(fileData);
                    
                    // Save file info to Firestore
                    await db.collection('files').add({
                        ...fileData,
                        conversationId: currentChatId,
                        userId: currentUser.uid,
                        uploadedAt: firebase